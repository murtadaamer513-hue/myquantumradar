<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Quantum Radar â€“ Pro</title>
<style>
  :root{ --green:#00ff7f; --bg:#000; --grid:#0a3a22; --txt:#b9ffd9; }
  *{ box-sizing:border-box }
  body{ margin:0; background:var(--bg); color:var(--green); font-family:system-ui,Segoe UI,Arial; }
  header{ padding:12px 10px 0; text-align:center }
  h1{ margin:0 0 6px; font-size:22px }
  #app{ max-width:1100px; margin:0 auto; display:grid; grid-template-columns:1fr 340px; gap:10px; padding:10px }
  @media(max-width:900px){ #app{ grid-template-columns:1fr } }
  /* Ø§Ù„Ø±Ø§Ø¯Ø§Ø± */
  #radarWrap{ display:flex; justify-content:center; align-items:center }
  canvas{ border-radius:50%;
          background:radial-gradient(circle at 50% 50%, #081108 0%, #020402 70%);
          box-shadow:0 0 28px rgba(0,255,127,.12) inset; touch-action:none }
  /* Ø§Ù„Ù„ÙˆØ­Ø© */
  .panel{ background:#06110b; border:1px solid #0a3a22; border-radius:14px; padding:10px; color:var(--txt) }
  .row{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin:8px 0 }
  button, input, select, label{ background:#08170e; color:var(--txt); border:1px solid #0a3a22; border-radius:10px; padding:8px 10px; font-size:14px }
  button{ cursor:pointer }
  button:hover{ filter:brightness(1.15) }
  input[type="number"], input[type="text"]{ width:90px }
  input[type="range"]{ width:180px }
  .muted{ color:#78eab5; font-size:13px }
  .status{ min-height:22px; margin-top:6px }
  .log{ height:180px; overflow:auto; background:#041009; border:1px dashed #0a3a22; border-radius:10px; padding:6px; font-family:ui-monospace,monospace; font-size:12.5px }
  .log .item{ padding:4px 2px; border-bottom:1px dashed #0a3a22 }
</style>
</head>
<body>
<header>
  <h1>ğŸ“¡ Ø±Ø§Ø¯Ø§Ø± Ù…Ø­Ø§ÙƒØ§Ø© â€“ Ù†Ø³Ø®Ø© Ù…ØªÙ‚Ø¯Ù…Ø©</h1>
  <div class="muted">Ø£Ø¶Ù Ø£Ù‡Ø¯Ø§ÙÙ‹Ø§ØŒ ØºÙŠÙ‘Ø± Ø§Ù„Ø³Ø±Ø¹Ø©ØŒ ÙØ¹Ù‘Ù„ Ø§Ù„Ø¶ÙˆØ¶Ø§Ø¡ØŒ Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø³Ø¬Ù„ØŒ ÙˆØµØ¯Ù‘Ø±/Ø§Ø³ØªÙˆØ±Ø¯ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù.</div>
</header>

<div id="app">
  <!-- Ø§Ù„Ø±Ø§Ø¯Ø§Ø± -->
  <div id="radarWrap">
    <canvas id="radar" width="420" height="420"></canvas>
  </div>

  <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
  <div class="panel">
    <div class="row">
      <button id="add">â• Ù‡Ø¯Ù Ø¹Ø´ÙˆØ§Ø¦ÙŠ</button>
      <button id="manualBtn">â• Ø¥Ø¶Ø§ÙØ© ÙŠØ¯ÙˆÙŠÙ‹Ø§</button>
      <label>Ø²Ø§ÙˆÙŠØ©Â° <input type="number" id="ang" value="42" min="0" max="359"></label>
      <label>Ù…Ø³Ø§ÙØ©% <input type="number" id="dist" value="60" min="5" max="95"></label>
    </div>

    <div class="row">
      <button id="clear">ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù</button>
      <button id="pause">â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù</button>
      <label>Ø§Ù„Ø³Ø±Ø¹Ø© <input type="range" id="speed" min="0.5" max="4" step="0.1" value="2"> <span id="speedVal">2.0</span>x</label>
    </div>

    <div class="row">
      <label><input type="checkbox" id="beep" checked> ØµÙˆØª</label>
      <label><input type="checkbox" id="noise"> Ø¶ÙˆØ¶Ø§Ø¡ (Ù†Ù‚Ø§Ø· ÙˆÙ‡Ù…ÙŠØ©)</label>
      <label>Ø­Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ø§Ù„ØªÙ‚Ø§Ø· <input type="range" id="window" min="0.04" max="0.2" step="0.01" value="0.09"> <span id="winVal">0.09</span></label>
    </div>

    <div class="row">
      <button id="exportBtn">â¬‡ï¸ ØªØµØ¯ÙŠØ± Ø£Ù‡Ø¯Ø§Ù (JSON)</button>
      <button id="importBtn">â¬†ï¸ Ø§Ø³ØªÙŠØ±Ø§Ø¯ JSON</button>
      <input id="importBox" type="text" placeholder='Ø£Ù„ØµÙ‚ JSON Ù‡Ù†Ø§' style="flex:1; min-width:140px">
    </div>

    <div class="status" id="status">Ø§Ø³Ø­Ø¨/Ø§Ù„Ù…Ø³ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø±Ø§Ø¯Ø§Ø± Ù„Ø¥Ø¶Ø§ÙØ© Ù‡Ø¯Ù Ø³Ø±ÙŠØ¹Ù‹Ø§.</div>
    <div class="log" id="log"></div>
  </div>
</div>

<script>
  // ===== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø±Ø³Ù… ÙˆØ§Ù„Ø±Ø§Ø¯Ø§Ø± =====
  const canvas = document.getElementById('radar');
  const ctx = canvas.getContext('2d');

  function fitCanvas(){
    const size = Math.min(520, Math.min(window.innerWidth, window.innerHeight) - 40);
    const s = Math.max(280, size);
    canvas.width = canvas.height = s;
  }
  fitCanvas(); window.addEventListener('resize', fitCanvas);

  const C = () => ({ x: canvas.width/2, y: canvas.height/2, r: canvas.width/2 - 10 });
  const xy = (c,R,a)=>({x:c.x+R*Math.cos(a), y:c.y+R*Math.sin(a)});
  const clamp = (v,min,max)=>Math.max(min,Math.min(max,v));

  // ===== Ø§Ù„Ø­Ø§Ù„Ø© =====
  const statusEl = document.getElementById('status');
  const logEl = document.getElementById('log');
  function log(msg){
    const el = document.createElement('div');
    el.className='item';
    el.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
    logEl.prepend(el);
  }

  const targets = JSON.parse(localStorage.getItem('qr_targets')||'[]');
  function saveTargets(){ localStorage.setItem('qr_targets', JSON.stringify(targets)); }

  // ===== Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… =====
  const addBtn = document.getElementById('add');
  const manualBtn = document.getElementById('manualBtn');
  const clearBtn = document.getElementById('clear');
  const pauseBtn = document.getElementById('pause');
  const speedRange = document.getElementById('speed');
  const speedVal = document.getElementById('speedVal');
  const winRange = document.getElementById('window');
  const winVal = document.getElementById('winVal');
  const beepChk = document.getElementById('beep');
  const noiseChk = document.getElementById('noise');
  const angInp = document.getElementById('ang');
  const distInp = document.getElementById('dist');
  const exportBtn = document.getElementById('exportBtn');
  const importBtn = document.getElementById('importBtn');
  const importBox = document.getElementById('importBox');

  speedVal.textContent = (+speedRange.value).toFixed(1);
  winVal.textContent = (+winRange.value).toFixed(2);
  speedRange.oninput = ()=> speedVal.textContent = (+speedRange.value).toFixed(1);
  winRange.oninput  = ()=> winVal.textContent  = (+winRange.value).toFixed(2);

  // Ø¥Ø¶Ø§ÙØ© Ø£Ù‡Ø¯Ø§Ù
  function addRandom(){
    targets.push({
      r: 0.12 + Math.random()*0.83,
      a: Math.random()*Math.PI*2,
      ttl: 0,
      drift: (Math.random()-0.5)*0.002
    });
    saveTargets();
    statusEl.textContent='âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ù‡Ø¯Ù Ø¹Ø´ÙˆØ§Ø¦ÙŠ.';
  }
  function addManual(){
    const deg = (+angInp.value||0)%360;
    const pct = clamp(+distInp.value||60, 5, 95);
    targets.push({ r:pct/100, a:deg*Math.PI/180, ttl:0, drift:0 });
    saveTargets();
    statusEl.textContent=`âœ… Ù‡Ø¯Ù ÙŠØ¯ÙˆÙŠ: Ø²Ø§ÙˆÙŠØ© ${deg}Â° â€“ Ù…Ø³Ø§ÙØ© ${pct}%`;
  }

  addBtn.onclick = addRandom;
  manualBtn.onclick = addManual;
  clearBtn.onclick = ()=>{ targets.length=0; saveTargets(); statusEl.textContent='ğŸ§¹ ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù.'; };
  exportBtn.onclick = ()=>{
    importBox.value = JSON.stringify(targets);
    importBox.select(); importBox.setSelectionRange(0,99999);
    statusEl.textContent='â¬‡ï¸ ØªÙ… Ù†Ø³Ø®/Ø¹Ø±Ø¶ JSON ÙÙŠ Ø§Ù„Ø­Ù‚Ù„.';
  };
  importBtn.onclick = ()=>{
    try{
      const arr = JSON.parse(importBox.value||'[]');
      if(Array.isArray(arr)){ targets.length=0; arr.forEach(t=>targets.push(t)); saveTargets(); statusEl.textContent='â¬†ï¸ ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯.'; }
      else statusEl.textContent='âš ï¸ ØµÙŠØºØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©.';
    }catch{ statusEl.textContent='âš ï¸ JSON ØºÙŠØ± ØµØ§Ù„Ø­.'; }
  };

  // Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ù„Ù„Ù…Ø³/Ø§Ù„Ù†Ù‚Ø±
  canvas.addEventListener('pointerdown', e=>{
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left, y = e.clientY - rect.top;
    const c = C();
    const dx = x - c.x, dy = y - c.y;
    const r = clamp(Math.hypot(dx,dy)/c.r, 0.05, 0.95);
    const a = Math.atan2(dy, dx);
    targets.push({ r, a, ttl:0, drift:0 });
    saveTargets();
    statusEl.textContent = `â• Ù‡Ø¯Ù Ø³Ø±ÙŠØ¹: Ø²Ø§ÙˆÙŠØ© ${Math.round((a*180/Math.PI+360)%360)}Â° â€“ Ù…Ø³Ø§ÙØ© ${(r*100).toFixed(0)}%`;
  }, {passive:true});

  // ===== Ø§Ù„ØµÙˆØª =====
  let audioCtx;
  function beep(){
    if(!beepChk.checked) return;
    if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    const o=audioCtx.createOscillator(), g=audioCtx.createGain();
    o.type='sine'; o.frequency.value=900;
    g.gain.value=0.12; o.connect(g).connect(audioCtx.destination);
    o.start(); g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.12);
    o.stop(audioCtx.currentTime + 0.13);
  }

  // ===== Ø§Ù„Ø±Ø³Ù… =====
  function ringColorByR(r){
    // Ù‚Ø±ÙŠØ¨ Ø£Ø­Ù…Ø±ØŒ Ù…ØªÙˆØ³Ø· Ø£ØµÙØ±ØŒ Ø¨Ø¹ÙŠØ¯ Ø£Ø®Ø¶Ø±
    if(r<0.33)  return 'rgba(255,90,90,';
    if(r<0.66)  return 'rgba(255,220,90,';
    return        'rgba(0,255,127,';
  }

  function drawGrid(c){
    ctx.lineWidth=1; ctx.strokeStyle='rgba(0,255,127,0.35)';
    for(let i=1;i<=4;i++){ ctx.beginPath(); ctx.arc(c.x,c.y,(c.r*i)/4,0,Math.PI*2); ctx.stroke(); }
    ctx.beginPath(); ctx.moveTo(c.x-c.r, c.y); ctx.lineTo(c.x+c.r, c.y);
    ctx.moveTo(c.x, c.y-c.r); ctx.lineTo(c.x, c.y+c.r); ctx.stroke();
  }

  let angle=0, paused=false;
  pauseBtn.onclick = ()=>{ paused=!paused; pauseBtn.textContent = paused ? 'â–¶ï¸ ØªØ´ØºÙŠÙ„' : 'â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù'; };

  // trail
  let lastStamp=performance.now();
  function loop(ts){
    const dt = Math.max(0, (ts-lastStamp)/1000); lastStamp=ts;
    const c = C();

    // Ø®Ù„ÙÙŠØ© ØªØªÙ„Ø§Ø´Ù‰ (Trail)
    ctx.fillStyle = 'rgba(0,0,0,0.25)';
    ctx.fillRect(0,0,canvas.width,canvas.height);

    drawGrid(c);

    // Ø¶ÙˆØ¶Ø§Ø¡ (Ù†Ù‚Ø§Ø· ÙˆÙ‡Ù…ÙŠØ©)
    if(noiseChk.checked){
      for(let i=0;i<4;i++){
        const rr = (0.1+Math.random()*0.9)*c.r;
        const aa = Math.random()*Math.PI*2;
        const p = xy(c, rr, aa);
        ctx.fillStyle='rgba(150,255,200,0.08)';
        ctx.beginPath(); ctx.arc(p.x,p.y, 2, 0, Math.PI*2); ctx.fill();
      }
    }

    // Ø§Ù„Ø£Ù‡Ø¯Ø§Ù
    const win = +winRange.value;
    targets.forEach(t=>{
      // Ø§Ù†Ø¬Ø±Ø§Ù Ø¨Ø³ÙŠØ·
      t.a += t.drift;

      const pos = xy(c, t.r*c.r, t.a);
      const diff = Math.atan2(Math.sin(t.a-angle), Math.cos(t.a-angle));
      const hit  = Math.abs(diff) < win;

      if(hit){
        t.ttl = 12;
        beep();
        const deg = Math.round((t.a*180/Math.PI+360)%360);
        const pct = Math.round(t.r*100);
        statusEl.textContent = `ğŸ¯ Ø§Ù„ØªÙ‚Ø§Ø·: Ø²Ø§ÙˆÙŠØ© ${deg}Â° â€“ Ù…Ø³Ø§ÙØ© ${pct}%`;
        log(`ğŸ¯ Ø²Ø§ÙˆÙŠØ© ${deg}Â° â€“ Ù…Ø³Ø§ÙØ© ${pct}%`);
      }

      // Ù„ÙˆÙ† Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ©
      const base = ringColorByR(t.r);
      ctx.fillStyle = base + (t.ttl>0 ? '1)' : '0.7)');
      ctx.beginPath(); ctx.arc(pos.x,pos.y, 5, 0, Math.PI*2); ctx.fill();
      // Ù‡Ø§Ù„Ø© Ø®ÙÙŠÙØ©
      ctx.strokeStyle = base + '0.35)'; ctx.beginPath();
      ctx.arc(pos.x,pos.y, 10, 0, Math.PI*2); ctx.stroke();

      if(t.ttl>0) t.ttl--;
    });

    // Ø´Ø¹Ø§Ø¹ Ø§Ù„Ù…Ø³Ù‘Ø§Ø­Ø© + Ù‡Ø§Ù„Ø©
    const tip = xy(c, c.r, angle);
    ctx.strokeStyle='#00ff7f'; ctx.lineWidth=2;
    ctx.beginPath(); ctx.moveTo(c.x,c.y); ctx.lineTo(tip.x, tip.y); ctx.stroke();

    const g = ctx.createRadialGradient(c.x,c.y,0,c.x,c.y,c.r);
    g.addColorStop(0,'rgba(0,255,127,0.02)');
    g.addColorStop(1,'rgba(0,255,127,0.10)');
    ctx.fillStyle=g;
    ctx.beginPath(); ctx.moveTo(c.x,c.y);
    ctx.arc(c.x,c.y,c.r, angle-0.33, angle+0.03); ctx.closePath(); ctx.fill();

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø²Ø§ÙˆÙŠØ©
    if(!paused){
      const speed = +speedRange.value; // rad/sec
      angle += speed * dt;
      if(angle>Math.PI*2) angle -= Math.PI*2;
    }

    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);
</script>
</body>
</html>
